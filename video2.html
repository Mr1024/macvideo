<!doctype html>
<html lanch="zh-cmn-Hans">

<head>
    <meta charset="utf-8">
    <title>视频</title>
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/mavvideo2.css" rel="stylesheet">
</head>

<body>
    <div id="videobox" tabindex="0">
        <video preload="auto" src="http://121.30.193.4/7f4b945f00000000-1422238330-1846736144/data21/newflv.sohu.ccgslb.net/sohu/s26h23eab6/98/78/7CUb5IBWRYGbp8DitzOJhD.mp4?key=74CNM_NtKeXhr3GbL04GPKJVbP8w5V_X&n=1&a=1822&cip=106.120.116.151&uid=1405121609390547&plat=17&pg=1&pt=5&ch=v&vid=2213589&prod=h5&eye=0">
        </video>
        <div class="actioncover"></div>
        <div class="controlbox">
            <div class="leftbox">
                <a id="switchplaybtn" class="icon-play"></a>
                <span class="time">00:00</span>
            </div>
            <div class="midbox">
                <div class="progressbarbox">
                    <div class="cacheprogressbox">
                        <div class="cacheprogress">
                        </div>
                    </div>
                    <div class="playgrogress">
                        <a class="scrollbtn" href="javascript:void(0)"></a>
                    </div>
                </div>
            </div>
            <div class="rightbox">
                <span class="totaltime">00:00</span>
                <div class="mutebox">
                    <a class="mutebtn icon-volume-up" href="javascript:void(0)"></a>
                    <div class="volumeprogressbox">
                        <div class="volumebox">
                            <div class="volumesel">
                                <a href="javascript:void(0)" class="volumbtn"></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="imagequalitybox">
                    <a href="javascript:void(0)" class="currentquality">高清</a>
                    <ul>
                        <li qtype="3">超清</li>
                        <li qtype="2">高清</li>
                        <li qtype="1">标清</li>
                    </ul>
                </div>
                <a href="javscript:void(0)" id="swfullscreen" class="icon-fullscreen"></a>
            </div>
        </div>
        <div class="loadingbox orbit">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <script>
    var macvolume = typeof localStorage.macvolume !== undefined ? localStorage.macvolume : (localStorage.macvolume = 1);
    var macquality = typeof localStorage.macquality !== undefined ? localStorage.macquality : (localStorage.macquality = 1);
    var $videobox = document.getElementById("videobox");
    var $loadingbox = $videobox.getElementsByClassName("loadingbox")[0];
    var $video = $videobox.getElementsByTagName("video")[0];
    var $actioncover = $videobox.getElementsByClassName("actioncover")[0];
    var $controlbox = $videobox.getElementsByClassName("controlbox")[0];
    var $switchplaybtn = document.getElementById("switchplaybtn");
    var $mutebox = $controlbox.getElementsByClassName("mutebox")[0];
    var $volumeprogressbox = $controlbox.getElementsByClassName("volumeprogressbox")[0];
    var $imagequalitybox = $controlbox.getElementsByClassName("imagequalitybox")[0];
    var $qualityselectbox = $imagequalitybox.getElementsByTagName("ul")[0];
    var $currentquality = $imagequalitybox.getElementsByClassName("currentquality")[0];
    var $switchfullscreen = document.getElementById("swfullscreen");
    var $playgrogress = $controlbox.getElementsByClassName("playgrogress")[0];
    var duration;
    var $scrollbtn = $controlbox.getElementsByClassName("scrollbtn")[0];
    var $progressbarbox = $controlbox.getElementsByClassName("progressbarbox")[0];
    var $volumebox = $controlbox.getElementsByClassName("volumebox")[0];
    var $volumesel = $volumebox.getElementsByClassName("volumesel")[0];
    var $volumbtn = $volumesel.getElementsByClassName("volumbtn")[0];
    $video.volume = macvolume;
    $volumesel.style.height = macvolume * 100 + "%";
    macquality = +macquality;
    switch (macquality) {
        case 1:
            $currentquality.innerHTML = "标清";
            break;
        case 2:
            $currentquality.innerHTML = "高清";
            break;
        case 3:
            $currentquality.innerHTML = "超清";
            break;
    }
    $video.addEventListener("volumechange", function(e) {
        var volume = e.target.volume;
        $volumesel.style.height = volume * 100 + "%";
    }, false);
    window.addEventListener("beforeunload", function(e) {
        localStorage.macvolume = macvolume;
        localStorage.macquality = macquality;
    }, false);
    $videobox.addEventListener("focus", function() {
        document.addEventListener("keydown", onKeyPress);
    }, false);
    $videobox.addEventListener("blur", function() {
        document.removeEventListener("keydown", onKeyPress);
    }, false);
    var onKeyPress = function(event) {
        var keyCode = event.keyCode ? event.keyCode : event.which ? event.which : event.charCode;
        var currentTime = $video.currentTime,
            volume = $video.volume;
        switch (keyCode) {
            case 13:
                if (event.shiftKey) {
                    $switchfullscreen.click();
                }
                break;
            case 32:
                $switchplaybtn.click();
                break;
            case 37:
                currentTime -= 5;
                break;
            case 38:
                volume += 0.1;
                break;
            case 39:
                currentTime += 5;
                break;
            case 40:
                volume -= 0.1;
        }

        if (duration && currentTime > duration) {
            $video.currentTime = duration;
        } else if (currentTime < 0) {
            $video.currentTime = 0;
        } else {
            $video.currentTime = currentTime;
        }
        if (volume > 1) {
            $video.volume = 1
        } else if (volume < 0) {
            $video.volume = 0;
        } else {
            $video.volume = volume;
        }

    };
    $videobox.focus();
    $switchplaybtn.addEventListener("click", function() {
        if ($video.paused) {
            $video.play();
        } else {
            $video.pause();
        }
    }, false);
    $switchfullscreen.addEventListener("click", function() {
        if (document.webkitIsFullScreen) {
            document.webkitCancelFullScreen();
        } else {
            $videobox.webkitRequestFullScreen();
        }
    }, false);
    $videobox.addEventListener("webkitfullscreenchange", function() {
        if (document.webkitIsFullScreen) {
            $switchfullscreen.className = "icon-resize-small";
        } else {
            $switchfullscreen.className = "icon-fullscreen";
        }
    }, false);
    $actioncover.addEventListener("click", function(e) {
        if ($video.paused) {
            $video.play();
        } else {
            $video.pause();
        }
    }, false);
    $actioncover.addEventListener("dblclick", function(e) {
        if (document.webkitIsFullScreen) {
            document.webkitCancelFullScreen();
        } else {
            $videobox.webkitRequestFullScreen();
        }
    }, false);
    var muteshowtag,
        qualityshowtag;
    $imagequalitybox.addEventListener("mouseenter", function() {
        if (qualityshowtag) {
            clearTimeout(qualityshowtag);
        }
        $qualityselectbox.style.display = "block";
    }, false);
    $imagequalitybox.addEventListener("mouseleave", function() {
        qualityshowtag = setTimeout(function() {
            $qualityselectbox.style.display = "none";
        }, 1000);
    }, false);
    $qualityselectbox.addEventListener("mouseenter", function() {
        if (qualityshowtag) {
            clearTimeout(qualityshowtag);
        }
    }, false);
    $qualityselectbox.addEventListener("click", function(event) {
        var that = event.target;
        if (that.nodeName.toLowerCase() == "li") {
            var qulity = that.innerHTML;
            $currentquality.innerHTML = qulity;
            $qualityselectbox.style.display = "none";
            macquality = that.getAttribute("qtype");
        }
    }, false)
    $mutebox.addEventListener("mouseenter", function() {
        if (muteshowtag) {
            clearTimeout(muteshowtag);
        }
        $volumeprogressbox.style.display = "block";
    }, false);
    $mutebox.addEventListener("mouseleave", function() {
        muteshowtag = setTimeout(function() {
            $volumeprogressbox.style.display = "none";
        }, 1000);
    }, false);
    $volumeprogressbox.addEventListener("mouseenter", function() {
        if (muteshowtag) {
            clearTimeout(muteshowtag);
        }
    }, false);
    $video.addEventListener("play", function() {
        $switchplaybtn.className = "icon-pause";
    }, false);
    $video.addEventListener("pause", function() {
        $switchplaybtn.className = "icon-play";
    }, false);
    $video.addEventListener("loadedmetadata", function() {
        duration = $video.duration;
        var minute = Math.floor(duration / 60);
        var second = Math.floor(duration % 60);
        var $totaltime = $videobox.getElementsByClassName("totaltime")[0];
        $totaltime.innerHTML = (minute < 10 ? '0' + minute : minute) + ":" + (second < 10 ? '0' + second : second);
        $controlbox.style.visibility = "visible";
    }, false);
    $video.addEventListener("timeupdate", function() {
        var currentTime = $video.currentTime;
        var minute = Math.floor(currentTime / 60);
        var second = Math.floor(currentTime % 60);
        var $currentTime = $controlbox.getElementsByClassName("time")[0];
        $currentTime.innerHTML = (minute < 10 ? '0' + minute : minute) + ":" + (second < 10 ? '0' + second : second);
        $playgrogress.style.width = currentTime / duration * 100 + "%";
    }, false);
    $video.addEventListener("progress", function() {
        var timeRange = $video.buffered;
        var rangelength = timeRange.length;
        if (rangelength > 0) {
            var cacheprogress = timeRange.end(rangelength - 1);
            var $cacheprogress = $controlbox.getElementsByClassName("cacheprogress")[0];
            $cacheprogress.style.width = cacheprogress / duration * 100 + "%";
        }
    }, false);
    $video.addEventListener("canplay", function() {
        $loadingbox.style.display = "none";
    }, false);
    $video.addEventListener("oncanplaythrough", function() {
        $loadingbox.style.display = "none";
    }, false);
    $video.addEventListener("playing", function() {
        $loadingbox.style.display = "none";
    }, false);
    $video.addEventListener("waiting", function() {
        $loadingbox.style.display = "block";
    }, false);
    $video.addEventListener("seeking", function() {
        $loadingbox.style.display = "block";
    }, false);
    $video.addEventListener("seekend", function() {
        $loadingbox.style.display = "none";
    }, false);
    $video.addEventListener("ended", function() {
        $switchplaybtn.className = "icon-play";
        $loadingbox.style.display = "none";
    }, false);
    drag($scrollbtn, $progressbarbox, $playgrogress, function(percentage) {
        $video.currentTime = percentage * duration;
    }, false)
    drag($volumbtn, $volumebox, $volumesel, function(percentage) {
        $video.volume = percentage;
        macvolume = percentage;
    }, true);
    clickMove($progressbarbox, $playgrogress, function() {
        $video.currentTime = percentage * duration;
    }, false);
    clickMove($volumebox, $volumesel, function() {
        $video.volume = percentage;
        macvolume = percentage;
    }, true);

    function clickMove($target, $moveTarget, callback, v) {
        var boxleft,
            boxtop,
            boxheight,
            boxwidth;
        $target.addEventListener("click", function(event) {
            boxleft = $target.getBoundingClientRect().left;
            boxtop = $target.getBoundingClientRect().top;
            boxheight = $target.offsetHeight;
            boxwidth = $target.offsetWidth;
            var left = event.clientX;
            var top = event.clientY;
            if (v == true) {
                if ((top - boxtop) <= boxheight && (top - boxtop) >= 0) {
                    percentage = (boxheight - top + boxtop) / boxheight;
                    $moveTarget.style.height = percentage * 100 + "%";
                    callback(percentage);
                }
            } else {
                if ((left - boxleft) <= boxwidth && (left - boxleft) >= 0) {
                    percentage = (left - boxleft) / boxwidth;
                    $moveTarget.style.width = percentage * 100 + "%";
                    callback(percentage);
                }
            }
        });
    }

    function drag($target, $rel, $moveTarget, callback, v) {
        var boxleft,
            boxtop,
            boxheight,
            boxwidth,
            mousetag = false;
        $target.addEventListener("mousedown", function() {
            mousetag = true;
            boxleft = $rel.getBoundingClientRect().left;
            boxtop = $rel.getBoundingClientRect().top;
            boxheight = $rel.offsetHeight;
            boxwidth = $rel.offsetWidth;
        }, false);
        $rel.addEventListener("mousemove", function(event) {
            var left = event.clientX;
            var top = event.clientY;
            var percentage;
            if (v == true) {
                if (mousetag && (top - boxtop) <= boxheight && (top - boxtop) >= 0) {
                    percentage = (boxheight - top + boxtop) / boxheight;
                    $moveTarget.style.height = percentage * 100 + "%";
                    callback(percentage);
                }
            } else {
                if (mousetag && (left - boxleft) <= boxwidth && (left - boxleft) >= 0) {
                    percentage = (left - boxleft) / boxwidth;
                    $moveTarget.style.width = percentage * 100 + "%";
                    callback(percentage);
                }
            }

        });
        document.addEventListener("mouseup", function() {
            mousetag = false;
        }, false);
    }
    </script>
</body>

</html>
