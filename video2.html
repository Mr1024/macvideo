<!doctype html>
<html lanch="zh-cmn-Hans">

<head>
    <meta charset="utf-8">
    <title>视频</title>
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/mavvideo2.css" rel="stylesheet">
</head>

<body>
    <div id="videobox">
        <video src="http://124.239.198.208/d2fd8e4800000000-1421051408-992946973/data9/newflv.sohu.ccgslb.net/sohu/s26h23eab6/78/134/C9M95lfrEWnhsmVjLlGeeF.mp4?key=3cmEXv2aQOTdrducF8Tn-Rp6eOmBmzDX&n=1&a=1822&cip=106.120.116.151&uid=1405121609390547&plat=17&pg=1&pt=5&ch=v&vid=2191544&prod=h5&eye=0">
        </video>
        <div class="controlbox">
            <div class="leftbox">
                <a id="switchplaybtn" class="icon-play"></a>
                <span class="time">00:00</span>
            </div>
            <div class="midbox">
                <div class="progressbarbox">
                    <div class="cacheprogressbox">
                        <div class="cacheprogress">
                        </div>
                    </div>
                    <div class="playgrogress">
                        <a class="scrollbtn" href="javascript:void(0)"></a>
                    </div>
                </div>
            </div>
            <div class="rightbox">
                <span class="totaltime">00:00</span>
                <div class="mutebox">
                    <a class="mutebtn icon-volume-up" href="javascript:void(0)"></a>
                    <div class="volumeprogressbox">
                        <div class="volumebox">
                            <div class="volumesel">
                                <a href="javascript:void(0)" class="volumbtn"></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="imagequalitybox">
                    <a href="javascript:void(0)" class="currentquality">高清</a>
                    <ul>
                        <li>普清</li>
                        <li>高清</li>
                        <li>超清</li>
                    </ul>
                </div>
                <a href="javscript:void(0)" id="swfullscreen" class="icon-fullscreen"></a>
            </div>
        </div>
        <div class="loadingbox orbit">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <script>
    var $videobox = document.getElementById("videobox");
    var $video = $videobox.getElementsByTagName("video")[0];
    var $controlbox = $videobox.getElementsByClassName("controlbox")[0];
    var $switchplaybtn = document.getElementById("switchplaybtn");
    var $mutebox = $controlbox.getElementsByClassName("mutebox")[0];
    var $volumeprogressbox = $controlbox.getElementsByClassName("volumeprogressbox")[0];
    var $imagequalitybox = $controlbox.getElementsByClassName("imagequalitybox")[0];
    var $qualityselectbox = $imagequalitybox.getElementsByTagName("ul")[0];
    var $currentquality = $imagequalitybox.getElementsByClassName("currentquality")[0];
    var $switchfullscreen = document.getElementById("swfullscreen");
    var $playgrogress = $controlbox.getElementsByClassName("playgrogress")[0];
    var duration;
    var $scrollbtn = $controlbox.getElementsByClassName("scrollbtn")[0];
    var $progressbarbox = $controlbox.getElementsByClassName("progressbarbox")[0];
    var $volumebox = $controlbox.getElementsByClassName("volumebox")[0];
    var $volumesel = $volumebox.getElementsByClassName("volumesel")[0];
    var $volumbtn = $volumesel.getElementsByClassName("volumbtn")[0];
    $switchplaybtn.onclick = function() {
        var playstatus = this.className;
        if (playstatus == "icon-play") {
            $switchplaybtn.className = "icon-pause";
            $video.play();
        } else {
            $switchplaybtn.className = "icon-play";
            $video.pause();
        }
    };
    $switchfullscreen.onclick = function() {
        var fullscreenstatus = this.className;
        if (fullscreenstatus == "icon-fullscreen") {
            this.className = "icon-resize-small";
            $videobox.webkitRequestFullScreen();
        } else {
            this.className = "icon-fullscreen";
            document.webkitCancelFullScreen();
        }
    };
    var muteshowtag,
        qualityshowtag;
    $imagequalitybox.addEventListener("mouseenter", function() {
        if (qualityshowtag) {
            clearTimeout(qualityshowtag);
        }
        $qualityselectbox.style.display = "block";
    }, false);
    $imagequalitybox.addEventListener("mouseleave", function() {
        qualityshowtag = setTimeout(function() {
            $qualityselectbox.style.display = "none";
        }, 1000);
    }, false);
    $qualityselectbox.addEventListener("mouseenter", function() {
        if (qualityshowtag) {
            clearTimeout(qualityshowtag);
        }
    }, false);
    $qualityselectbox.addEventListener("click", function(event) {
        var that = event.target;
        if (that.nodeName.toLowerCase() == "li") {
            var qulity = that.innerHTML;
            $currentquality.innerHTML=qulity;
            $qualityselectbox.style.display = "none";
        }
    }, false)
    $mutebox.addEventListener("mouseenter", function() {
        if (muteshowtag) {
            clearTimeout(muteshowtag);
        }
        $volumeprogressbox.style.display = "block";
    }, false);
    $mutebox.addEventListener("mouseleave", function() {
        muteshowtag = setTimeout(function() {
            $volumeprogressbox.style.display = "none";
        }, 1000);
    }, false);
    $volumeprogressbox.addEventListener("mouseenter", function() {
        if (muteshowtag) {
            clearTimeout(muteshowtag);
        }
    }, false);
    $video.addEventListener("loadedmetadata", function() {
        duration = $video.duration;
        var minute = Math.floor(duration / 60);
        var second = Math.floor(duration % 60);
        var $totaltime = $videobox.getElementsByClassName("totaltime")[0];
        $totaltime.innerHTML = (minute < 10 ? '0' + minute : minute) + ":" + (second < 10 ? '0' + second : second);
        $controlbox.style.visibility = "visible";
    }, false);
    $video.addEventListener("timeupdate", function() {
        var currentTime = $video.currentTime;
        var minute = Math.floor(currentTime / 60);
        var second = Math.floor(currentTime % 60);
        var $currentTime = $controlbox.getElementsByClassName("time")[0];
        $currentTime.innerHTML = (minute < 10 ? '0' + minute : minute) + ":" + (second < 10 ? '0' + second : second);
        $playgrogress.style.width = currentTime / duration * 100 + "%";
    }, false);
    $video.addEventListener("progress", function() {
        var timeRange = $video.buffered;
        var rangelength = timeRange.length;
        if (rangelength > 0) {
            var cacheprogress = timeRange.end(rangelength - 1);
            var $cacheprogress = $controlbox.getElementsByClassName("cacheprogress")[0];
            $cacheprogress.style.width=cacheprogress/duration*100+"%";
        }
    }, false);
    $video.addEventListener("ended", function() {
        $switchplaybtn.className = "icon-play";
    }, false);
    drag($scrollbtn, $progressbarbox, $playgrogress, function(percentage) {
        $video.currentTime = percentage * duration;
    }, false)
    drag($volumbtn, $volumebox, $volumesel, function(percentage) {
        $video.volume = percentage;
    }, true);

    function drag($target, $rel, $moveTarget, callback, v) {
        var boxleft,
            boxtop,
            boxheight,
            boxwidth,
            mousetag = false;
        $target.addEventListener("mousedown", function() {
            mousetag = true;
            boxleft = $rel.getBoundingClientRect().left;
            boxtop = $rel.getBoundingClientRect().top;
            boxheight = $rel.offsetHeight;
            boxwidth = $rel.offsetWidth;
        }, false);
        $rel.addEventListener("mousemove", function(event) {
            var left = event.clientX;
            var top = event.clientY;
            var percentage;
            if (v == true) {
                if (mousetag && (top - boxtop) <= boxheight && (top - boxtop) >= 0) {
                    percentage = (boxheight - top + boxtop) / boxheight;
                    $moveTarget.style.height = percentage * 100 + "%";
                    callback(percentage);
                }
            } else {
                if (mousetag && (left - boxleft) <= boxwidth && (left - boxleft) >= 0) {
                    percentage = (left - boxleft) / boxwidth;
                    $moveTarget.style.width = percentage * 100 + "%";
                    callback(percentage);
                }
            }

        });
        document.addEventListener("mouseup", function() {
            mousetag = false;
        }, false);
    }
    </script>
</body>

</html>
