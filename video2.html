<!doctype html>
<html lanch="zh-cmn-Hans">

<head>
    <meta charset="utf-8">
    <title>视频</title>
    <link href="css/font-awesome.min.css" rel="stylesheet">
    <link href="css/mavvideo2.css" rel="stylesheet">
</head>

<body>
    <div id="videobox">
        <video src="http://124.239.198.208/d2fd8e4800000000-1421051408-992946973/data9/newflv.sohu.ccgslb.net/sohu/s26h23eab6/78/134/C9M95lfrEWnhsmVjLlGeeF.mp4?key=3cmEXv2aQOTdrducF8Tn-Rp6eOmBmzDX&n=1&a=1822&cip=106.120.116.151&uid=1405121609390547&plat=17&pg=1&pt=5&ch=v&vid=2191544&prod=h5&eye=0">
        </video>
        <div class="controlbox">
            <div class="leftbox">
                <a id="switchplaybtn" class="icon-play"></a>
                <span class="time">00:00</span>
            </div>
            <div class="midbox">
                <div class="progressbarbox">
                    <div class="cacheprogress">
                    </div>
                    <div class="playgrogress">
                        <a class="scrollbtn" href="javascript:void(0)"></a>
                    </div>
                </div>
            </div>
            <div class="rightbox">
                <span class="totaltime">00:00</span>
                <div class="mutebox">
                    <a class="mutebtn icon-volume-up" href="javascript:void(0)"></a>
                    <div class="volumeprogressbox">
                        <div class="volumebox">
                            <div class="volumesel">
                                <a href="javascript:void(0)" class="volumbtn"></a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="imagequalitybox">
                    <a href="javascript:void(0)" class="currentquality">高清</a>
                    <ul>
                        <li>普清</li>
                        <li>高清</li>
                        <li>超清</li>
                    </ul>
                </div>
                <a href="javscript:void(0)" id="swfullscreen" class="icon-fullscreen"></a>
            </div>
        </div>
        <div class="loadingbox orbit">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>

    <script>
    var $switchplaybtn = document.getElementById("switchplaybtn");
    var $video = document.getElementsByTagName("video")[0];
    var $mutebox = document.getElementsByClassName("mutebox")[0];
    var $volumeprogressbox = document.getElementsByClassName("volumeprogressbox")[0];
    var $imagequalitybox = document.getElementsByClassName("imagequalitybox")[0];
    var $qualityselectbox = $imagequalitybox.getElementsByTagName("ul")[0];
    var $switchfullscreen = document.getElementById("swfullscreen");
    var $videobox = document.getElementById("videobox");
    var $controlbox = $videobox.getElementsByClassName("controlbox")[0];
    var $playgrogress = $controlbox.getElementsByClassName("playgrogress")[0];
    var duration;
    var $scrollbtn = $controlbox.getElementsByClassName("scrollbtn")[0];
    var $progressbarbox = $controlbox.getElementsByClassName("progressbarbox")[0];
    $switchplaybtn.onclick = function() {
        var playstatus = this.className;
        if (playstatus == "icon-play") {
            $switchplaybtn.className = "icon-pause";
            $video.play();
        } else {
            $switchplaybtn.className = "icon-play";
            $video.pause();
        }
    };
    $switchfullscreen.onclick = function() {
        var fullscreenstatus = this.className;
        if (fullscreenstatus == "icon-fullscreen") {
            this.className = "icon-resize-small";
            $videobox.webkitRequestFullScreen();
        } else {
            this.className = "icon-fullscreen";
            document.webkitCancelFullScreen();
        }
    };
    $mutebox.addEventListener("mouseover", function() {
        if (muteshowtag) {
            clearTimeout(muteshowtag);
        }
        $volumeprogressbox.style.display = "block";
    }, false);
    var muteshowtag;
    $mutebox.addEventListener("mouseout", function() {
        muteshowtag = setTimeout(function() {
            $volumeprogressbox.style.display = "none";
        }, 1000);
    }, false);
    $volumeprogressbox.addEventListener("mouseover", function() {
        if (muteshowtag) {
            clearTimeout(muteshowtag);
        }
    }, false);
    $volumeprogressbox.addEventListener("mouseout", function() {
        muteshowtag = setTimeout(function() {
            $volumeprogressbox.style.display = "none";
        }, 1000);
    }, false);
    $imagequalitybox.onmouseover = function() {
        $qualityselectbox.style.display = "block";
    }
    $imagequalitybox.onmouseout = function() {
        $qualityselectbox.style.display = "none";
    }
    $video.addEventListener("loadedmetadata", function() {
        duration = $video.duration;
        var minute = Math.floor(duration / 60);
        var second = Math.floor(duration % 60);
        var $totaltime = $videobox.getElementsByClassName("totaltime")[0];
        console.log($totaltime);
        $totaltime.innerHTML = (minute < 10 ? '0' + minute : minute) + ":" + (second < 10 ? '0' + second : second);
        $controlbox.style.visibility = "visible";
    }, false);
    $video.addEventListener("timeupdate", function() {
        var currentTime = $video.currentTime;
        var minute = Math.floor(currentTime / 60);
        var second = Math.floor(currentTime % 60);
        var $currentTime = $controlbox.getElementsByClassName("time")[0];
        $currentTime.innerHTML = (minute < 10 ? '0' + minute : minute) + ":" + (second < 10 ? '0' + second : second);
        var playgrogress = currentTime / duration * 100;
        var cacheprogress = $video.buffered.end(0) / duration * 100;
        $controlbox.getElementsByClassName("cacheprogress")[0].style.width = cacheprogress + "%";
        $controlbox.getElementsByClassName("playgrogress")[0].style.width = playgrogress + "%";
    }, false);
    $video.addEventListener("ended", function() {
        $switchplaybtn.className = "icon-play";
        $playgrogress.style.width = currentTime / duration * 100 + "%";
    }, false);
    drag($scrollbtn, $progressbarbox, $playgrogress, false)

    function drag($target, $rel, $moveTarget, v) {
        var boxleft = $rel.getBoundingClientRect().left;
        var boxtop = $rel.getBoundingClientRect().top;
        console.log(boxleft);
        var boxheight = $rel.offsetHeight;
        var boxwidth = $rel.offsetWidth;
        var mousetag = false;
        $target.addEventListener("mousedown", function() {
            mousetag = true;
        }, false);
        document.addEventListener("mousemove", function(event) {
            var left = event.clientX;
            var top = event.clientY;
            if (v == true) {
                if (mousetag && (top - boxtop) <= boxheight) {
                    $moveTarget.style.width = (top - boxtop) / boxheight * 100 + "%";
                }
            } else {
                if (mousetag && (left - boxleft) <= boxwidth) {
                    $moveTarget.style.width = (left - boxleft) / boxwidth * 100 + "%";
                }
            }

        });
        document.addEventListener("mouseup", function() {
            mousetag = false;
        }, false);
    }
    </script>
</body>

</html>
